{{#section 'js'}}
<script>
  function viewDetail(index) {
    var detailIndex = "row" + index;
    var rowDetail = document.getElementById(detailIndex)
    if (rowDetail.style.display == "")
      document.getElementById(detailIndex).style.display = "none";
    else if (rowDetail.style.display == "none")
      document.getElementById(detailIndex).style.display = "";
  }

  function editCategory(index) {
    let categoryName = $("#txtCategory" + index).val();
    if (categoryName !== '') {
      $.getJSON(`/admin/Categories/validation?categoryname=${categoryName}&id=${index}`, (data) => {
        if (data["result"] == 0) {
          $.post(
            "/admin/Categories/edit",
            { TenChuyenMuc: categoryName, id: index },
            window.alert("Sửa thành công!")
          );
        }
        if(data["result"] == 1){
          alert("Đã tồn tại chuyên mục con này ở trong chuyên mục cha đã chọn!");
        }
        if(data["result"] == 2){
          alert("Đã tồn tại chuyên mục cha!");
        }
      });
    }
    else {
      alert("Tên category không được rỗng!");
    }

  }

  function delCategory(index) {
    let btnName = "btnDelCategory" + index;
    $.getJSON(`/admin/Categories/del/${index}`, (data) => {
      if (data["result"] == '0') {
        alert("Xóa thành công!");
        $('#' + btnName).closest('tr').remove();
      }
      if (data["result"] == '1')
        alert("Chuyên mục vẫn còn chứa bài viết! Không thể xóa!");
      if (data["result"] == '2')
        alert("Chuyên mục vẫn còn chứa chuyên mục con! Không thể xóa!");

    });
  }
</script>
{{/section}}
<div class="card">
  <div class="card-header">
    <h4>Danh sách chuyên mục</h4>
  </div>
  <div class="card">
    <div class="card-header d-flex justify-content-between">
      <a class="btn btn-outline-success" href="/admin/Categories/add" role="button">
        <i class="fa fa-plus" aria-hidden="true"></i>
        Thêm Chuyên mục
      </a>
    </div>
    <table class="table table-hover">
      <thead>
        <tr style="background-color:bisque">
          <th scope="col" class="text-left" style="width: 10%">#</th>
          <th scope="col" style="width: 60%;" class="text-center">Tên chuyên mục</th>
          <th scope="col" class="text-center">View detail</th>
          <th scope="col" class="text-center">Action</th>
        </tr>
      </thead>
      <tbody>
        {{#each List}}
        <tr>
          <th scope="row" class="text-left">
            <p>{{@index}}</p>
          </th>
          <td class="text-center">
            <input id="txtCategory{{this.0.id}}" style="border:5mm;text-align:center;"
              value="{{this.0.TenChuyenMuc}}"></input>
          </td>
          <td class="text-center">
            <button type="button" class="btn btn-primary" onclick="viewDetail({{this.0.id}})"><i class="fa fa-eye"
                aria-hidden="true"></i></button>
          </td>
          <td class="text-center">
            <button id="btnEditCategory{{this.0.id}}" class="btn btn-primary btn-sm" role="button" title="Sửa category"
              onclick="editCategory({{this.0.id}})">
              <i class="fa fa-pencil" aria-hidden="true">sửa</i>
            </button>
            <button id="btnDelCategory{{this.0.id}}" class="btn btn-danger btn-sm" role="button" title="Xóa category"
              onclick="delCategory({{this.0.id}})">
              <i class="fa fa-trash" aria-hidden="true">Xóa</i>
            </button>
          </td>
        </tr>

        <tr id="row{{this.0.id}}" style="display:none">
          <td></td>
          <td class="text-center" colspan="2">
            <table class="table table-hover">
              <thead>
                <tr style="background-color:lightgray">
                  <th scope="col" class="text-left" style="width: 20%">#</th>
                  <th scope="col" style="width: 60%;" class="text-center">Tên chuyên mục con</th>
                  <th scope="col" class="text-center">Action</th>
                </tr>
              </thead>

              <tbody>
                {{#each this}}
                {{#if (isNotEqual @index 0)}}
                <tr id="row{{ChuyenMucCon}}" class="childRow">
                  <td></td>
                  <td class="text-center"><input id="txtCategory{{id}}" style="border:5mm;text-align: center;"
                      value="{{TenChuyenMuc}}"></input></td>
                  <td class="text-left">
                    <button id="btnEditCategory{{id}}" class="btn btn-primary btn-sm" role="button" title="Sửa category"
                      onclick="editCategory({{id}})">
                      <i class="fa fa-pencil" aria-hidden="true">sửa</i>
                    </button>
                    <button id="btnDelCategory{{id}}" class="btn btn-danger btn-sm" role="button" title="Xóa category"
                      onclick="delCategory({{id}})">
                      <i class="fa fa-trash" aria-hidden="true">Xóa</i>
                    </button>
                  </td>
                </tr>
                {{/if}}
                {{/each}}
              </tbody>
            </table>
          </td>
        </tr>
        {{/each}}
      </tbody>
    </table>
  </div>
</div>